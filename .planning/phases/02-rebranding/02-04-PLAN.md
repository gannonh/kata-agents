---
phase: 02-rebranding
plan: 04
type: execute
wave: 2
depends_on:
  - "02-01"
  - "02-02"
  - "02-03"
files_modified:
  - packages/shared/src/docs/doc-links.ts
  - packages/shared/src/version/manifest.ts
  - packages/shared/src/sources/builtin-sources.ts
  - packages/shared/src/prompts/system.ts
  - apps/electron/src/main/menu.ts
  - apps/electron/src/main/auto-update.ts
  - apps/electron/electron-builder.yml
  - apps/electron/package.json
  - scripts/install-app.sh
  - scripts/install-app.ps1
autonomous: true

must_haves:
  truths:
    - "No 'craft.do' domain references in source code (excluding LICENSE/NOTICE)"
    - "Help menu links are disabled or point to valid URLs"
    - "Version in package.json is 0.4.0"
    - "GitHub release workflow will create v0.4.0 release"
  artifacts:
    - path: "apps/electron/package.json"
      provides: "Package with version 0.4.0"
      contains: '"version": "0.4.0"'
    - path: ".github/workflows/release.yml"
      provides: "Release workflow (existing, no changes needed)"
      min_lines: 10
  key_links:
    - from: "apps/electron/package.json"
      to: ".github/workflows/release.yml"
      via: "version change trigger"
      pattern: "version.*0\\.4\\.0"
---

<objective>
Remove or update all craft.do domain references in the codebase and configure the project for v0.4.0 release via GitHub Actions.

Purpose: Achieves trademark compliance (BRAND-03) by removing external references to Craft infrastructure, and prepares the distribution mechanism (DIST-01) for the first Kata Desktop release.

Output: Codebase has no craft.do references in active code, and pushing to main with version 0.4.0 will trigger a GitHub release.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-rebranding/02-RESEARCH.md

@packages/shared/src/docs/doc-links.ts
@packages/shared/src/version/manifest.ts
@apps/electron/src/main/auto-update.ts
@.github/workflows/release.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove/update craft.do domain references</name>
  <files>
    packages/shared/src/docs/doc-links.ts
    packages/shared/src/version/manifest.ts
    packages/shared/src/sources/builtin-sources.ts
    packages/shared/src/prompts/system.ts
    apps/electron/src/main/menu.ts
    apps/electron/src/main/auto-update.ts
    apps/electron/electron-builder.yml
    scripts/install-app.sh
    scripts/install-app.ps1
  </files>
  <action>
Find all craft.do references and handle appropriately:

```bash
grep -r "craft\.do" --include="*.ts" --include="*.tsx" --include="*.yml" --include="*.sh" --include="*.ps1" .
```

For each file, apply the appropriate fix:

1. **packages/shared/src/docs/doc-links.ts** - DOC_BASE_URL:
   ```typescript
   // Disable external docs until kata.sh docs exist
   export const DOC_BASE_URL = '';  // Was: 'https://agents.craft.do/docs'
   ```

2. **packages/shared/src/version/manifest.ts** - VERSIONS_URL:
   ```typescript
   // Disable version manifest until kata.sh hosts it
   export const VERSIONS_URL = '';  // Was: 'https://agents.craft.do/...'
   ```

3. **packages/shared/src/sources/builtin-sources.ts** - MCP docs:
   - Comment out or remove mcp.craft.do references
   - These are documentation URLs, safe to disable

4. **packages/shared/src/prompts/system.ts** - Git co-author:
   - Change "Craft Agent" email to "Kata Desktop" or generic
   - `git-co-author@kata.sh` or similar placeholder

5. **apps/electron/src/main/menu.ts** - Help menu:
   - Line 199: Change `https://agents.craft.do/docs` to `https://github.com/gannonh/kata-desktop` (GitHub repo as docs for now)

6. **apps/electron/src/main/auto-update.ts** - Update server:
   - The update URL is also in electron-builder.yml
   - Comment out or disable auto-update until kata.sh update server exists
   - Add a comment explaining this is disabled

7. **apps/electron/electron-builder.yml** - publish.url:
   - Line 41: Comment out the generic provider or change to GitHub releases:
   ```yaml
   publish:
     provider: github
     owner: gannonh
     repo: kata-desktop
   ```
   This enables auto-update from GitHub releases.

8. **scripts/install-app.sh** and **scripts/install-app.ps1**:
   - These reference agents.craft.do for downloads
   - Update to use GitHub releases URL or disable

Also check for support@craft.do and security@craft.do:
- Update to appropriate Kata contact or remove
  </action>
  <verify>
grep -r "craft\.do" --include="*.ts" --include="*.tsx" --include="*.yml" --include="*.sh" --include="*.ps1" . | grep -v "node_modules" | grep -v ".planning" | grep -v "NOTICE" | grep -v "LICENSE" | grep -v "TRADEMARK"
# Should return no matches (or only in allowed files)
  </verify>
  <done>
No craft.do references remain in source code (excluding documentation about the fork origin)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update version and verify release workflow</name>
  <files>
    apps/electron/package.json
    .github/workflows/release.yml
  </files>
  <action>
1. Update version in apps/electron/package.json:
   - Find the "version" field (currently something like "0.3.x")
   - Change to "0.4.0"

2. Verify release.yml workflow configuration:
   ```bash
   cat .github/workflows/release.yml
   ```

   The workflow should:
   - Trigger on push to main when version changes
   - Build for macOS (arm64, x64), Windows (x64), Linux (x64)
   - Create GitHub release with artifacts

   If the workflow uses `electron-builder --publish always`, it will automatically:
   - Create a GitHub release tagged with the version
   - Upload all built artifacts

3. Ensure the workflow has proper permissions:
   ```yaml
   permissions:
     contents: write  # Needed to create releases
   ```

4. Update any "Craft" references in the workflow file to "Kata":
   - Release name/title if customized
   - Any artifact naming (should already use ${productName} from electron-builder.yml)
  </action>
  <verify>
grep '"version"' apps/electron/package.json | head -1
# Should show "version": "0.4.0"
grep -E "(contents: write|permissions:)" .github/workflows/release.yml
# Should show permissions for release creation
  </verify>
  <done>
Version is 0.4.0 and release workflow has correct permissions for GitHub release creation
  </done>
</task>

<task type="auto">
  <name>Task 3: Final verification and documentation cleanup</name>
  <files>
    README.md
    SECURITY.md
    CODE_OF_CONDUCT.md
  </files>
  <action>
1. Run comprehensive craft.do search:
   ```bash
   grep -r "craft\.do" . --include="*.ts" --include="*.tsx" --include="*.js" --include="*.json" --include="*.yml" --include="*.yaml" --include="*.md" --include="*.sh" --include="*.ps1" | grep -v node_modules | grep -v ".planning" | grep -v "bun.lock"
   ```

   Categorize results:
   - **Must remove:** Active code paths
   - **Keep:** LICENSE, NOTICE, TRADEMARK.md (required attribution)
   - **Update:** README.md, SECURITY.md, CODE_OF_CONDUCT.md (user-facing docs)

2. Update README.md:
   - Change project name to Kata Desktop
   - Update any craft.do links to GitHub or remove
   - Keep attribution to original Craft Agents project

3. Update SECURITY.md:
   - Change security@craft.do to appropriate contact
   - Or link to GitHub security advisories

4. Update CODE_OF_CONDUCT.md:
   - Change any Craft-specific references
   - Keep standard code of conduct content

5. Run type check to ensure no broken imports:
   ```bash
   bun run typecheck:all
   ```

6. Run tests to ensure nothing broke:
   ```bash
   bun test
   ```
  </action>
  <verify>
# Count remaining craft.do references (should only be in allowed files)
grep -r "craft\.do" . --include="*.ts" --include="*.tsx" --include="*.json" --include="*.yml" | grep -v node_modules | grep -v ".planning" | grep -v "bun.lock" | wc -l
# Should be 0 or very low (only in attribution files)

bun run typecheck:all && echo "Type check: OK"
bun test && echo "Tests: OK"
  </verify>
  <done>
All craft.do references removed from active code, documentation updated, build and tests pass
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Domain reference check:
```bash
# This should return 0 matches for active source files
grep -r "craft\.do" --include="*.ts" --include="*.tsx" --include="*.yml" . | grep -v node_modules | grep -v ".planning" | wc -l
```

2. Version check:
```bash
grep '"version": "0.4.0"' apps/electron/package.json && echo "Version: OK"
```

3. Build verification:
```bash
bun run electron:build
# Should complete successfully
```

4. Release workflow check:
```bash
grep "provider: github" apps/electron/electron-builder.yml || grep "contents: write" .github/workflows/release.yml
# At least one should match (either GitHub provider in builder or write permissions in workflow)
```
</verification>

<success_criteria>
1. `grep -r "craft\.do" --include="*.ts" --include="*.tsx" . | grep -v node_modules | wc -l` returns 0
2. `grep '"version": "0.4.0"' apps/electron/package.json` returns a match
3. `bun run typecheck:all` passes
4. `bun test` passes
5. Release workflow is configured to create GitHub releases
</success_criteria>

<output>
After completion, create `.planning/phases/02-rebranding/02-04-SUMMARY.md`
</output>
