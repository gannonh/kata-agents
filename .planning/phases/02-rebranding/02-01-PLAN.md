---
phase: 02-rebranding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/electron/electron-builder.yml
  - apps/electron/src/main/index.ts
  - apps/electron/src/main/menu.ts
  - apps/electron/src/renderer/index.html
  - apps/electron/src/renderer/playground.html
  - apps/viewer/index.html
autonomous: true

must_haves:
  truths:
    - "Application window title shows 'Kata Desktop'"
    - "macOS menu bar shows 'Kata Desktop' application menu"
    - "About menu item displays 'About Kata Desktop'"
    - "Bundle ID is 'sh.kata.desktop' in build configuration"
  artifacts:
    - path: "apps/electron/electron-builder.yml"
      provides: "Build configuration with Kata branding"
      contains: "sh.kata.desktop"
    - path: "apps/electron/src/main/index.ts"
      provides: "Main process with Kata app name"
      contains: "Kata Desktop"
    - path: "apps/electron/src/main/menu.ts"
      provides: "Menu labels with Kata branding"
      contains: "Kata Desktop"
  key_links:
    - from: "apps/electron/electron-builder.yml"
      to: "Built application"
      via: "electron-builder packaging"
      pattern: "productName.*Kata Desktop"
---

<objective>
Update all user-facing product names and metadata from "Craft Agents" to "Kata Desktop" and change bundle ID to `sh.kata.desktop`.

Purpose: Establishes Kata Desktop identity in the most visible places (title bar, menus, system identification) while keeping internal code intact.

Output: Application displays "Kata Desktop" everywhere users see the name, and builds produce correctly-identified artifacts.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-rebranding/02-RESEARCH.md

@apps/electron/electron-builder.yml
@apps/electron/src/main/index.ts
@apps/electron/src/main/menu.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update electron-builder configuration</name>
  <files>apps/electron/electron-builder.yml</files>
  <action>
Update the following fields in electron-builder.yml:

1. Line 1: `appId: com.lukilabs.craft-agent` -> `appId: sh.kata.desktop`
2. Line 2: `productName: Craft Agents` -> `productName: Kata Desktop`
3. Line 3: Keep copyright as-is (Apache 2.0 requires attribution)
4. Line 72: `artifactName: "Craft-Agent-${arch}.${ext}"` -> `artifactName: "Kata-Desktop-${arch}.${ext}"`
5. Line 80: `artifactName: "Craft-Agent-${arch}.dmg"` -> `artifactName: "Kata-Desktop-${arch}.dmg"`
6. Line 86: `title: "Craft Agents"` -> `title: "Kata Desktop"`
7. Line 105: `artifactName: "Craft-Agent-${arch}.${ext}"` -> `artifactName: "Kata-Desktop-${arch}.${ext}"`
8. Line 133: Update maintainer email from `support@craft.do` to a placeholder or remove domain
9. Line 138: `artifactName: "Craft-Agent-${arch}.${ext}"` -> `artifactName: "Kata-Desktop-${arch}.${ext}"`

Do NOT change:
- The `publish.url` field (handled in later plan)
- Copyright attribution to Craft Docs Ltd. (required by license)
  </action>
  <verify>
grep -E "(appId|productName|artifactName|title:)" apps/electron/electron-builder.yml | head -10
# Should show sh.kata.desktop, Kata Desktop, Kata-Desktop-${arch}
  </verify>
  <done>
electron-builder.yml has bundle ID `sh.kata.desktop`, product name "Kata Desktop", and artifact names starting with "Kata-Desktop"
  </done>
</task>

<task type="auto">
  <name>Task 2: Update main process app name and environment variables</name>
  <files>apps/electron/src/main/index.ts</files>
  <action>
Update the following in index.ts:

1. Line ~90: Change `process.env.CRAFT_DEBUG` reference comment to note legacy support
2. Line ~97: Change `CRAFT_DEEPLINK_SCHEME` to `KATA_DEEPLINK_SCHEME` (keep CRAFT_ as fallback for migration)
   ```typescript
   const DEEPLINK_SCHEME = process.env.KATA_DEEPLINK_SCHEME || process.env.CRAFT_DEEPLINK_SCHEME || 'kata'
   ```
3. Line ~107: Change app name:
   ```typescript
   app.setName(process.env.KATA_APP_NAME || 'Kata Desktop')
   ```
4. Update any comments mentioning "Craft Agents" to "Kata Desktop"

Keep backward compatibility: Support both KATA_ and CRAFT_ env vars during transition.
  </action>
  <verify>
grep -E "(setName|DEEPLINK_SCHEME|APP_NAME)" apps/electron/src/main/index.ts
# Should show Kata Desktop and kata:// scheme references
  </verify>
  <done>
Main process sets app name to "Kata Desktop" and uses `kata://` deeplink scheme by default
  </done>
</task>

<task type="auto">
  <name>Task 3: Update menu labels and HTML titles</name>
  <files>
    apps/electron/src/main/menu.ts
    apps/electron/src/renderer/index.html
    apps/electron/src/renderer/playground.html
    apps/viewer/index.html
  </files>
  <action>
In menu.ts, update all "Craft Agents" references:
1. Line 63: `label: 'Craft Agents'` -> `label: 'Kata Desktop'`
2. Line 65: `label: 'About Craft Agents'` -> `label: 'About Kata Desktop'`
3. Line 74: `label: 'Hide Craft Agents'` -> `label: 'Hide Kata Desktop'`
4. Line 78: `label: 'Quit Craft Agents'` -> `label: 'Quit Kata Desktop'`
5. Line 185: Update "Craft Agent" in dialog message to "Kata Desktop"
6. Line 199: Keep the docs URL for now (handled in later plan)

Update comments:
- Line 11: "Craft Agents app" -> "Kata Desktop app"
- Line 25: "Craft logo menu" -> "app logo menu"

In HTML files, update titles:
- index.html line 7: `<title>Craft Agents</title>` -> `<title>Kata Desktop</title>`
- playground.html: Same title update if exists
- apps/viewer/index.html: `<title>Craft Agents</title>` -> `<title>Kata Desktop</title>`
  </action>
  <verify>
grep -r "Craft Agents" apps/electron/src/main/menu.ts apps/electron/src/renderer/index.html apps/viewer/index.html
# Should return no matches
  </verify>
  <done>
All menu labels show "Kata Desktop" and HTML titles display "Kata Desktop"
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Build configuration check:
```bash
grep "sh.kata.desktop" apps/electron/electron-builder.yml && echo "Bundle ID: OK"
grep "Kata Desktop" apps/electron/electron-builder.yml && echo "Product name: OK"
```

2. Source code check:
```bash
grep -r "Craft Agents" apps/electron/src/main/*.ts apps/electron/src/renderer/*.html apps/viewer/*.html
# Should return no matches (except comments about original project)
```

3. Type check:
```bash
bun run typecheck:all
```
</verification>

<success_criteria>
1. `grep "appId: sh.kata.desktop" apps/electron/electron-builder.yml` returns match
2. `grep "productName: Kata Desktop" apps/electron/electron-builder.yml` returns match
3. `grep -c "Kata Desktop" apps/electron/src/main/menu.ts` returns 4+ matches
4. `grep "<title>Kata Desktop</title>" apps/electron/src/renderer/index.html` returns match
5. `bun run typecheck:all` passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-rebranding/02-01-SUMMARY.md`
</output>
