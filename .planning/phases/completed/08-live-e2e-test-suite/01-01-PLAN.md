---
phase: 01-live-e2e-test-suite
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/electron/e2e/fixtures/live.fixture.ts
  - apps/electron/package.json
  - apps/electron/e2e/tests/live/.gitkeep
autonomous: true
source_issue: ""

must_haves:
  truths:
    - "Live fixture validates credentials exist before launching app"
    - "bun run test:e2e:live script exists and targets live test directory"
    - "tests/live/ directory exists for live test files"
  artifacts:
    - path: "apps/electron/e2e/fixtures/live.fixture.ts"
      provides: "Enhanced live fixture with credential validation"
      contains: "credentials.enc"
    - path: "apps/electron/package.json"
      provides: "test:e2e:live script"
      contains: "test:e2e:live"
    - path: "apps/electron/e2e/tests/live/.gitkeep"
      provides: "Live tests directory marker"
  key_links:
    - from: "package.json"
      to: "playwright.config.ts"
      via: "testDir/testMatch pattern"
      pattern: "tests/live"
---

<objective>
Set up live E2E test infrastructure by enhancing the existing live.fixture.ts with credential validation and adding the test:e2e:live npm script.

Purpose: Fulfills E2E-01 (live fixture infrastructure) and E2E-02 (separate test script) requirements. Creates the foundation for all live tests.

Output: Enhanced live fixture that validates credentials, test script in package.json, and directory structure for live tests.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/v0.7.0/01-live-e2e-test-suite/01-RESEARCH.md

@apps/electron/e2e/fixtures/live.fixture.ts
@apps/electron/package.json
@apps/electron/e2e/README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance live.fixture.ts with credential validation</name>
  <files>apps/electron/e2e/fixtures/live.fixture.ts</files>
  <action>
Add credential validation to live.fixture.ts that checks `~/.kata-agents/credentials.enc` exists before launching the app. This prevents confusing test failures when credentials are missing.

Modify the `electronApp` fixture:

1. At the start of the fixture (before execSync calls), add:
   - Import `existsSync` from 'fs'
   - Check if `path.join(homedir(), '.kata-agents', 'credentials.enc')` exists
   - If not, throw a clear error: `Error: Live E2E tests require credentials. Run the app first and authenticate via OAuth to create ~/.kata-agents/credentials.enc`

2. Add a named export for the demo config directory path:
   - `export const DEMO_CONFIG_DIR = path.join(homedir(), '.kata-agents-demo')`
   - This allows tests to reference the demo directory for file verification if needed

Keep all existing functionality intact (demo setup scripts, app launch, splash wait).
  </action>
  <verify>
Run `bunx playwright test --grep "should have a visible window" --reporter=list` from apps/electron to confirm existing tests still pass.
Temporarily rename credentials.enc and run a live test to confirm the error message appears.
  </verify>
  <done>
live.fixture.ts checks for credentials.enc and provides clear error if missing. DEMO_CONFIG_DIR is exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add test:e2e:live script and create directory structure</name>
  <files>apps/electron/package.json, apps/electron/e2e/tests/live/.gitkeep</files>
  <action>
1. Add new npm scripts to apps/electron/package.json:
   - `"test:e2e:live": "playwright test tests/live/"` - runs only live tests
   - `"test:e2e:live:debug": "playwright test tests/live/ --debug"` - debug mode for live tests
   - `"test:e2e:live:headed": "playwright test tests/live/ --headed"` - headed mode to watch tests

Place these scripts after the existing `test:e2e:debug` entry for logical grouping.

2. Create the directory structure:
   - Create `apps/electron/e2e/tests/live/` directory
   - Add `.gitkeep` file to preserve empty directory until tests are added

3. Update apps/electron/e2e/README.md:
   - Add a new section "Running Live Tests" that documents:
     - Prerequisites (valid credentials in ~/.kata-agents/credentials.enc)
     - The three new scripts: test:e2e:live, test:e2e:live:debug, test:e2e:live:headed
     - Note that live tests use real Claude API and take longer than mock tests
  </action>
  <verify>
Run `bun run test:e2e:live` from apps/electron directory. It should run without error (no tests yet, so 0 passed).
Verify the scripts appear in package.json.
Verify tests/live/.gitkeep exists.
  </verify>
  <done>
test:e2e:live script runs Playwright against tests/live/ directory. Directory structure ready for test files.
  </done>
</task>

</tasks>

<verification>
```bash
# From apps/electron directory
cd apps/electron

# Verify script exists and runs (should report 0 tests since directory is empty)
bun run test:e2e:live

# Verify directory exists
ls -la e2e/tests/live/

# Verify credential check works (manual test)
# Temporarily: mv ~/.kata-agents/credentials.enc ~/.kata-agents/credentials.enc.bak
# Run: bun run test:e2e:live
# Should see clear error about missing credentials
# Restore: mv ~/.kata-agents/credentials.enc.bak ~/.kata-agents/credentials.enc
```
</verification>

<success_criteria>
1. `bun run test:e2e:live` script exists and runs from apps/electron
2. live.fixture.ts validates credentials.enc exists before launching
3. Clear error message when credentials missing
4. `tests/live/` directory exists and is tracked via .gitkeep
5. README.md documents the live test workflow
</success_criteria>

<output>
After completion, create `.planning/phases/v0.7.0/01-live-e2e-test-suite/01-01-SUMMARY.md`
</output>
