---
phase: 10-foundation-types-and-permission-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared/src/plugins/types.ts
  - packages/shared/src/plugins/index.ts
  - packages/shared/src/channels/types.ts
  - packages/shared/src/channels/index.ts
  - packages/core/src/types/daemon.ts
  - packages/core/src/types/index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "KataPlugin interface compiles with registerChannels, registerTools, registerServices methods"
    - "ChannelAdapter interface defines poll and subscribe ingress modes"
    - "DaemonStatus and DaemonEvent types are importable from @craft-agent/core"
  artifacts:
    - path: "packages/shared/src/plugins/types.ts"
      provides: "KataPlugin, ChannelRegistry, ToolRegistry, ServiceRegistry, PluginService, PluginContext, PluginLogger interfaces"
      min_lines: 50
    - path: "packages/shared/src/channels/types.ts"
      provides: "ChannelAdapter, ChannelMessage, ChannelFilter, ChannelConfig interfaces"
      min_lines: 40
    - path: "packages/core/src/types/daemon.ts"
      provides: "DaemonStatus, DaemonCommand, DaemonEvent types"
      min_lines: 20
    - path: "packages/shared/src/plugins/index.ts"
      provides: "Re-exports from types.ts"
    - path: "packages/shared/src/channels/index.ts"
      provides: "Re-exports from types.ts"
  key_links:
    - from: "packages/shared/src/plugins/types.ts"
      to: "packages/shared/src/channels/types.ts"
      via: "import type { ChannelAdapter }"
      pattern: "import type.*ChannelAdapter.*channels/types"
    - from: "packages/core/src/types/index.ts"
      to: "packages/core/src/types/daemon.ts"
      via: "export type re-export"
      pattern: "export type.*from.*daemon"
---

<objective>
Define the plugin contract, channel adapter interface, and daemon event types as pure TypeScript type definitions.

Purpose: Establish the type foundation that all subsequent phases (daemon core, channel adapters, plugin lifecycle) will build upon. These interfaces are the contracts that concrete implementations must satisfy.

Output: Three new type files (plugins/types.ts, channels/types.ts, core/types/daemon.ts) with barrel re-exports.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/pending/10-foundation-types-and-permission-mode/10-RESEARCH.md

@packages/shared/src/sources/types.ts (interface design pattern)
@packages/core/src/types/index.ts (re-export pattern)
@packages/core/src/types/session.ts (interface conventions)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create channel adapter and plugin contract type files</name>
  <files>
    packages/shared/src/channels/types.ts
    packages/shared/src/channels/index.ts
    packages/shared/src/plugins/types.ts
    packages/shared/src/plugins/index.ts
  </files>
  <action>
Create two new directories and their type files following the `packages/shared/src/sources/types.ts` pattern.

**channels/types.ts** defines:
- `ChannelAdapter` interface: `readonly id: string`, `readonly name: string`, `readonly type: 'poll' | 'subscribe'`, `start(config: ChannelConfig, onMessage: (msg: ChannelMessage) => void): Promise<void>`, `stop(): Promise<void>`, `isHealthy(): boolean`, `getLastError(): string | null`
- `ChannelMessage` interface: `id: string`, `channelId: string`, `source: string`, `timestamp: number`, `content: string`, `metadata: Record<string, unknown>`, optional `replyTo?: { threadId: string; messageId: string }`
- `ChannelFilter` interface: optional `triggerPatterns?: string[]`, optional `channelIds?: string[]`
- `ChannelConfig` interface: `slug: string`, `enabled: boolean`, `adapter: string`, optional `pollIntervalMs?: number`, `credentials: { sourceSlug: string }`, optional `filter?: ChannelFilter`

**channels/index.ts**: Re-export all types from `./types.ts` using `export type`.

**plugins/types.ts** defines:
- `KataPlugin` interface: `readonly id: string`, `readonly name: string`, `readonly version: string`, optional `registerChannels?(registry: ChannelRegistry): void`, optional `registerTools?(registry: ToolRegistry): void`, optional `registerServices?(registry: ServiceRegistry): void`, optional `initialize?(context: PluginContext): Promise<void>`, optional `shutdown?(): Promise<void>`
- `ChannelRegistry` interface: `addAdapter(id: string, factory: () => ChannelAdapter): void` (imports ChannelAdapter from channels/types.ts)
- `ToolRegistry` interface: `addTool(tool: unknown): void` (typed as unknown; Phase 11+ will use SDK import)
- `ServiceRegistry` interface: `addService(id: string, service: PluginService): void`
- `PluginService` interface: `start(): Promise<void>`, `stop(): Promise<void>`
- `PluginContext` interface: `workspaceRootPath: string`, `getCredential: (sourceSlug: string) => Promise<string | null>`, `logger: PluginLogger`
- `PluginLogger` interface: `info(message: string): void`, `warn(message: string): void`, `error(message: string): void`, `debug(message: string): void`

**plugins/index.ts**: Re-export all types from `./types.ts` using `export type`.

Use `import type` for cross-file imports (verbatimModuleSyntax). Include `.ts` extensions in imports (Bun convention). Add JSDoc comments on all interfaces and their fields describing purpose.
  </action>
  <verify>
Run `cd /Users/gannonhall/dev/kata/kata-agents && bun run typecheck:all` to confirm all types compile.
  </verify>
  <done>
KataPlugin interface compiles with all three optional registration methods. ChannelAdapter interface defines poll and subscribe type discriminant. All types have JSDoc comments. Barrel re-exports work.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create daemon event types in core package</name>
  <files>
    packages/core/src/types/daemon.ts
    packages/core/src/types/index.ts
  </files>
  <action>
Create `packages/core/src/types/daemon.ts` with daemon-specific types that the Electron app will need for IPC communication:

- `DaemonStatus` type: `'starting' | 'running' | 'stopping' | 'stopped' | 'error'`
- `DaemonCommand` type: discriminated union with `type` field:
  - `{ type: 'start' }`
  - `{ type: 'stop' }`
  - `{ type: 'health_check' }`
  - `{ type: 'plugin_action'; pluginId: string; action: string; payload?: unknown }`
- `DaemonEvent` type: discriminated union with `type` field:
  - `{ type: 'status_changed'; status: DaemonStatus; error?: string }`
  - `{ type: 'message_received'; channelId: string; messageId: string }`
  - `{ type: 'message_sent'; channelId: string; messageId: string }`
  - `{ type: 'plugin_loaded'; pluginId: string }`
  - `{ type: 'plugin_error'; pluginId: string; error: string }`

Update `packages/core/src/types/index.ts` to re-export all types from `./daemon.ts` using `export type`. Follow the existing re-export pattern (grouped by domain with a comment header).
  </action>
  <verify>
Run `cd /Users/gannonhall/dev/kata/kata-agents && bun run typecheck:all` to confirm daemon types compile and are importable from `@craft-agent/core`.
  </verify>
  <done>
DaemonStatus, DaemonCommand, and DaemonEvent types compile and are re-exported from `packages/core/src/types/index.ts`.
  </done>
</task>

</tasks>

<verification>
1. `bun run typecheck:all` passes with zero errors
2. Types are importable: `import type { KataPlugin } from '../plugins/types.ts'` resolves
3. Types are importable: `import type { ChannelAdapter } from '../channels/types.ts'` resolves
4. Types are importable: `import type { DaemonStatus } from '@craft-agent/core'` resolves
5. No runtime code exists in any new file (type-only exports)
</verification>

<success_criteria>
- KataPlugin interface compiles with registerChannels, registerTools, registerServices optional methods
- ChannelAdapter interface defines poll and subscribe ingress modes via type discriminant
- DaemonStatus, DaemonCommand, DaemonEvent types available from @craft-agent/core
- All new files follow codebase conventions (JSDoc, .ts extensions, import type, verbatimModuleSyntax)
</success_criteria>

<output>
After completion, create `.planning/phases/pending/10-foundation-types-and-permission-mode/10-01-SUMMARY.md`
</output>
