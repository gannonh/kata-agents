---
phase: 01-setup-and-tooling
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - UPSTREAM.md
autonomous: true

must_haves:
  truths:
    - "Developer can configure upstream remote"
    - "Developer can sync upstream changes to tracking branch"
    - "Developer can cherry-pick specific commits to feature branches"
    - "Developer knows adoption criteria for different change types"
  artifacts:
    - path: "UPSTREAM.md"
      provides: "Upstream management documentation"
      min_lines: 50
      contains: "git remote add upstream"
  key_links:
    - from: "UPSTREAM.md"
      to: "https://github.com/AiCodecraft/craft-agents"
      via: "remote URL"
      pattern: "AiCodecraft/craft-agents"
---

<objective>
Document the upstream management strategy for maintaining Kata Desktop as a fork of Craft Agents.

Purpose: Enable maintainers to track, evaluate, and selectively adopt changes from the upstream Craft Agents repository. Without this, the fork will diverge without clear process for incorporating bug fixes or SDK updates.

Output: UPSTREAM.md with setup commands, sync process, cherry-pick workflow, and adoption criteria.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-setup-and-tooling/01-CONTEXT.md
@.planning/phases/01-setup-and-tooling/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UPSTREAM.md documentation</name>
  <files>UPSTREAM.md</files>
  <action>
Create `UPSTREAM.md` in repository root with these sections:

**# Upstream Management**

Brief intro: Kata Desktop is a fork of Craft Agents. This document describes how to track and selectively adopt upstream changes.

**## Source Repository**
- URL: https://github.com/AiCodecraft/craft-agents
- Remote name: `upstream`
- Sync branch: `upstream/sync`

**## Initial Setup**
```bash
# Add upstream remote (one-time)
git remote add upstream https://github.com/AiCodecraft/craft-agents.git

# Create sync branch to track upstream
git fetch upstream
git checkout -b upstream/sync upstream/main --no-track
git push origin upstream/sync
```

**## Monthly Sync Process**
```bash
# 1. Update sync branch
git checkout upstream/sync
git fetch upstream
git reset --hard upstream/main
git push origin upstream/sync --force

# 2. Review new commits
git log upstream/sync --oneline -20

# 3. Compare with our main
git log main..upstream/sync --oneline
```

**## Cherry-Pick Workflow**
```bash
# 1. Create feature branch from main
git checkout main
git checkout -b feature/upstream-[description]

# 2. Cherry-pick specific commit(s)
git cherry-pick <commit-sha>

# 3. Resolve conflicts if any, then push
git push origin feature/upstream-[description]

# 4. Open PR to main - follows standard review process
```

**## Adoption Criteria**

| Change Type | Policy | Rationale |
|-------------|--------|-----------|
| Bug fixes | Adopt readily | Direct user benefit, low risk |
| Security patches | Adopt immediately | Critical for user safety |
| SDK updates | Evaluate carefully | Test before adopting, may have breaking changes |
| New features | Case-by-case | Evaluate fit with Kata direction |
| Refactors | Generally skip | Adds merge complexity without user value |
| Branding changes | Never adopt | Defeats purpose of fork |

**## Conflict Resolution**

When cherry-picking causes conflicts:
1. Resolve in the feature branch, not in main
2. If conflict is extensive, consider skipping that commit
3. Document significant conflict resolutions in PR description

**## Review Cadence**
- Monthly: Review upstream commits, identify candidates
- As-needed: Cherry-pick security fixes immediately
- Quarterly: Evaluate SDK version alignment
  </action>
  <verify>
File exists at `UPSTREAM.md` with:
- `git remote add upstream` command
- `upstream/sync` branch references
- Cherry-pick workflow section
- Adoption criteria table
- At least 50 lines of content
  </verify>
  <done>UPSTREAM.md documents complete upstream management strategy</done>
</task>

<task type="auto">
  <name>Task 2: Verify upstream remote configuration</name>
  <files>N/A (verification only)</files>
  <action>
Check if upstream remote is already configured. If not, provide the setup command but do NOT automatically add it (that's a user decision for their local environment).

```bash
# Check current remotes
git remote -v

# If upstream not present, user should run:
# git remote add upstream https://github.com/AiCodecraft/craft-agents.git
```

Add a note to UPSTREAM.md if the remote is not yet configured, reminding users to run the setup commands.

This task is verification and documentation update only - do not modify git remotes.
  </action>
  <verify>
`git remote -v` shows current remote configuration
UPSTREAM.md exists and contains setup instructions
  </verify>
  <done>Upstream remote status documented, setup instructions clear</done>
</task>

</tasks>

<verification>
```bash
# Verify UPSTREAM.md exists and has required content
test -f UPSTREAM.md && echo "File exists: OK"
grep -q "git remote add upstream" UPSTREAM.md && echo "Setup command: OK"
grep -q "upstream/sync" UPSTREAM.md && echo "Sync branch: OK"
grep -q "cherry-pick" UPSTREAM.md && echo "Cherry-pick: OK"
grep -q "Adoption Criteria" UPSTREAM.md && echo "Criteria section: OK"
wc -l UPSTREAM.md | awk '{print ($1 >= 50) ? "Line count: OK" : "Line count: FAIL"}'
```
</verification>

<success_criteria>
1. UPSTREAM.md exists in repository root
2. Contains setup commands for upstream remote
3. Documents sync process with upstream/sync branch
4. Includes cherry-pick workflow for selective adoption
5. Defines adoption criteria by change type
6. At least 50 lines of substantive documentation
</success_criteria>

<output>
After completion, create `.planning/phases/01-setup-and-tooling/01-02-SUMMARY.md`
</output>
