# Milestone v0.6.1: Testing Infrastructure

**Status:** SHIPPED 2026-02-05
**Goal:** Establish baseline test coverage and live E2E testing capabilities with real credentials.
**Phases:** 1-2
**Total Plans:** 6

## Overview

Internal infrastructure milestone focused on testing quality. Added live E2E tests using real OAuth credentials in an isolated demo environment, configured coverage reporting with CI-enforced thresholds, and documented coverage gaps with rationale.

## Phases

### Phase 1: Live E2E Test Suite

**Goal**: E2E tests verify core user workflows end-to-end with real credentials.
**Depends on**: None
**Plans**: 3 plans

Plans:
- [x] 01-01: Test infrastructure setup (credential validation, test script)
- [x] 01-02: Auth and chat live tests (E2E-03, E2E-04)
- [x] 01-03: Session, git, permission tests (E2E-05, E2E-06, E2E-07)

**Details:**
- Created live E2E fixture with credential validation before app launch
- Added `data-testid` and `data-streaming` attributes for test targeting
- Implemented page object pattern for ChatPage interactions
- Tests run against `~/.kata-agents-demo/` isolated environment
- Skip single-instance lock when KATA_CONFIG_DIR is set for parallel test runs

---

### Phase 2: Unit Test Coverage

**Goal**: Unit tests cover critical modules with documented coverage gaps.
**Depends on**: None
**Plans**: 3 plans

Plans:
- [x] 02-01: Coverage configuration (bunfig.toml settings, exclude release artifacts)
- [x] 02-02: Coverage gaps documentation (COVERAGE.md with analysis and rationale)
- [x] 02-03: Coverage thresholds (gap closure: CI enforcement, summary script)

**Details:**
- Configured bun test coverage with ignore patterns for release artifacts
- Created comprehensive coverage analysis with three-tier gap categorization
- Built coverage summary script for threshold enforcement
- Added coverage threshold check to CI pipeline
- COV-02 (pr-service.ts tests) discovered to already exist

---

## Milestone Summary

**Key Decisions:**
- Decision: Validate credentials.enc before launch in live fixture (Rationale: Prevents confusing test failures)
- Decision: Dynamic branch detection in git tests (Rationale: Demo repo may be on different branch)
- Decision: data-streaming attribute on TurnCard (Rationale: Wait for streaming completion in tests)
- Decision: Skip single-instance lock with KATA_CONFIG_DIR (Rationale: Enable parallel test runs)
- Decision: Regression thresholds below current coverage (Rationale: Protect against regression, not enforce aspirational targets)
- Decision: Three-tier coverage gap categorization (Rationale: Distinguish actionable gaps from integration-test-territory)

**Issues Resolved:**
- No live E2E tests existed (now 5 live test files covering auth, chat, session, git, permissions)
- Coverage reporting not configured (now bunfig.toml + CI enforcement)
- pr-service.ts test gap (discovered existing tests at pr-service.test.ts)

**Issues Deferred:**
- Mock API server for CI-based chat testing (issue #49)
- Mock MCP servers for tool discovery testing (issue #49)
- Git repo test fixtures for CI (issue #49)

**Technical Debt Incurred:**
- Coverage thresholds set conservatively below current levels (regression guard, not aspirational)
- MCP and workspace switching E2E tests not yet implemented

---

_For current project status, see .planning/ROADMAP.md_
