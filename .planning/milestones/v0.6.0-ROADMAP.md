# Milestone v0.6.0: Git Integration

**Status:** SHIPPED 2026-02-04
**Goal:** Show developers their git context (branch, PR) in the workspace UI while working with the agent.
**Phases:** 3-7
**Total Plans:** 14

## Overview

v0.6.0 adds git awareness to Kata Agents. Developers see their current git branch and linked PR directly in the workspace UI, with real-time updates and AI context injection so the agent understands the developer's git workflow.

## Phases

### Phase 3: Core Git Service

**Goal**: Workspace UI displays current git branch, with graceful handling of non-git directories.
**Depends on**: None (foundation for this milestone)
**Plans**: 4 plans

Plans:
- [x] 03-01: Create GitService module with simple-git
- [x] 03-02: Wire GitService to IPC layer
- [x] 03-03: Create renderer state management (Jotai atoms)
- [x] 03-04: Create GitStatusBadge UI component

**Requirements:** GIT-01, GIT-02, GIT-03

**Details:**
- GitService module using simple-git in main process (async-only)
- IPC handler for GIT_STATUS channel
- Workspace-scoped state (Map<workspaceId, GitState>)
- GitBranchBadge placed in chat input toolbar

---

### Phase 4: PR Integration

**Goal**: User sees linked PR information when current branch has an open pull request.
**Depends on**: Phase 3 (requires git branch detection)
**Plans**: 2 plans

Plans:
- [x] 04-01: Create PR service module and wire to IPC layer
- [x] 04-02: Create PrBadge UI component

**Requirements:** PR-01, PR-02, PR-03, PR-04

**Details:**
- Uses gh CLI for PR data (already authenticated on developer machines)
- PR badge colors match GitHub conventions (green/purple/red/gray)
- Graceful degradation when gh CLI unavailable

---

### Phase 5: Real-Time Updates

**Goal**: Git and PR status stay current without manual refresh.
**Depends on**: Phase 4 (real-time updates apply to both git and PR)
**Plans**: 4 plans

Plans:
- [x] 05-01: Create GitWatcher with chokidar and IPC broadcast
- [x] 05-02: Add focus-aware PR polling to renderer
- [x] 05-03: Connect useGitStatus to GitWatcher events and focus
- [x] 05-04: Wire GitBranchBadge to live git state (gap closure)

**Requirements:** LIVE-01, LIVE-02, LIVE-03

**Details:**
- chokidar v4 watching selective .git paths (.git/index, .git/HEAD, .git/refs/)
- 100ms debounce on file system events
- Focus-aware PR polling with usePrStatus hook
- GitBranchBadge as pure display component (no local fetch)

---

### Phase 6: AI Context Injection

**Goal**: Agent receives git context and can reference it in responses.
**Depends on**: Phase 4 (needs both branch and PR data)
**Plans**: 1 plan

Plans:
- [x] 06-01: Create formatGitContext, wire into CraftAgent and SessionManager

**Requirements:** CTX-01, CTX-02

**Details:**
- XML-tagged git context (~100-200 chars) injected per user message
- Fresh fetch before each message (not cached)
- Matches existing context injection patterns in CraftAgent

---

### Phase 7: Polish and Edge Cases

**Goal**: Handle edge cases and improve reliability of git integration.
**Depends on**: Phase 6 (all core functionality complete)
**Plans**: 3 plans

Plans:
- [x] 07-01: Defensive error handling (worktree support, existsSync guard, ENOSPC)
- [x] 07-02: Deprecate legacy GET_GIT_BRANCH execSync handler
- [x] 07-03: GitWatcher integration tests

**Requirements:** None (polish phase)

**Details:**
- resolveGitDir() handles worktrees and submodules (.git as file with gitdir pointer)
- ENOSPC errors produce actionable Linux inotify instructions
- existsSync guards prevent simple-git console noise
- GET_GIT_BRANCH handler replaced execSync with async delegation
- 10 integration tests for GitWatcher

---

## Milestone Summary

**Key Decisions:**
- Use simple-git for git operations (8.5M weekly downloads, TypeScript-native)
- Use gh CLI for PR data (already authenticated on developer machines)
- Workspace-scoped state for multi-workspace support
- Git branch badge in chat input toolbar (better visibility than sidebar)
- XML-tagged git context per user message (prompt caching friendly)
- chokidar v4 for cross-platform .git file watching

**Issues Resolved:**
- GitBranchBadge wiring gap (05-04 gap closure plan)
- Non-git directory handling in PrService
- Git status scoped to working directory vs workspace root
- Session filters scoped to active workspace

**Issues Deferred:**
- Dirty indicator (uncommitted changes count)
- Ahead/behind remote count
- PR review status details
- Branch switching from UI

**Technical Debt Incurred:**
- GitStatusBadge.tsx exists but is unused (inline GitBranchBadge used instead)
- Deprecated GET_GIT_BRANCH channel retained for backward compatibility
- isGitRepository() exported but not called externally

---

_For current project status, see .planning/ROADMAP.md_
